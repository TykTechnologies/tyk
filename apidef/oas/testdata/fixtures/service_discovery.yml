---
name: "Service Discovery"
tests:
  - desc: "From OAS to Classic"
    source: oas
    input:
      x-tyk-api-gateway:
        upstream:
          serviceDiscovery:
            enabled: true
    output:
      proxy:
        service_discovery:
          use_discovery_service: true
          cache_disabled: true
          cache_timeout: 0
  - desc: "From Classic to OAS"
    source: classic
    errors:
      desc: "Errors are checked and wanted (general OAS validation)"
      enabled: true
      want: true
    input:
      name: "Name"
      proxy:
        service_discovery:
          use_discovery_service: true
          cache_disabled: false
          cache_timeout: 10
    output:
      info:
        title: "Name"
      x-tyk-api-gateway:
        upstream:
          serviceDiscovery:
            enabled: true
            cache:
              enabled: true
              timeout: 10
  - desc: "From Classic to OAS"
    source: classic
    errors:
      desc: "Errors are checked and wanted (general OAS validation)"
      enabled: true
      want: true
    input:
      name: "Name"
      proxy:
        service_discovery:
          use_discovery_service: false
          cache_disabled: true
          cache_timeout: 10
    output:
      info:
        title: "Name"
      x-tyk-api-gateway:
        upstream:
          serviceDiscovery:
            enabled: false
            cache:
              enabled: false
              timeout: 10
  # If service discovery is disabled (unconfigured) then honor
  # cache_disabled=false as being still disabled.
  - desc: "From Classic to OAS"
    source: classic
    errors:
      desc: "Errors are checked and wanted (general OAS validation)"
      enabled: true
      want: true
    input:
      name: "Name"
      proxy:
        service_discovery:
          use_discovery_service: false
          cache_disabled: false
    output:
      info:
        title: "Name"
      x-tyk-api-gateway:
        upstream:
          serviceDiscovery: "<nil>"
