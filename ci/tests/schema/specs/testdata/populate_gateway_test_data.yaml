name: Manage APIs and Policies
testcases:
  - name: Delete API
    steps:
      - type: http
        method: DELETE
        url: http://localhost:8080/tyk/apis/f84ve1a04e5648c2797170567971565n
        headers:
          X-Tyk-Authorization: {{ .bearerToken }}
        assertions:
          - result.statuscode ShouldBeIn 200 404

  - name: Create API
    steps:
      - type: http
        method: POST
        url: http://localhost:8080/tyk/apis
        headers:
          Content-Type: application/json
          X-Tyk-Authorization: {{ .bearerToken }}
        body: |
          {
            "api_id": "f84ve1a04e5648c2797170567971565n",
            "auth": {
              "auth_header_name": "authorization"
            },
            "definition": {
              "key": "version",
              "location": "header"
            },
            "name": "Tyk Test API",
            "org_id": "664a14650619d40001f1f00f",
            "proxy": {
              "listen_path": "/tyk-api-test/",
              "strip_listen_path": true,
              "target_url": "https://httpbin.org"
            },
          "graphql": {
              "enabled": false
          },
            "use_oauth2": true,
            "version_data": {
              "not_versioned": true,
              "versions": {
                "Default": {
                  "name": "Default"
                }
              }
            }
          }
        assertions:
          - result.statuscode ShouldEqual 200
  - name: Reload  gateway
    steps:
      - type: http
        method: GET
        url: http://localhost:8080/tyk/reload
        headers:
          X-Tyk-Authorization: {{ .bearerToken }}
        assertions:
          - result.statuscode ShouldBeIn 200
