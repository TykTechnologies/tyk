

# Generated by: tyk-ci/wf-gen
# Generated on: Monday 28 February 2022 10:17:25 AM UTC

# Generation commands:
# ./meta.zsh -repos tyk -title sync-automation -branch sync/td-876
# m4 -E -DxSRC_BRANCH='master' -DxRELEASE_BRANCHES='release-4-lts, release-3.2.3, release-4' -DxAUTO_FILES='ci/goreleaser/goreleaser.yml ci/goreleaser/goreleaser-el7.yml ci/Dockerfile.std ci/Dockerfile.slim ci/aws/byol.pkr.hcl .github/workflows/release.yml .github/workflows/del-env.yml ci/terraform/outputs.tf .github/dependabot.yml ci/install/before_install.sh ci/install/post_install.sh ci/install/post_remove.sh ci/install/post_trans.sh .github/workflows/api-tests.yml'

# This workflow will silently ignore FILES that are missing in master
# Most of the time this is what we want, older repos may not have some files

name: Sync automation

on:
  push:
    branches:
      - master
    paths:
      - .github/workflows/release.yml
      - .github/workflows/api-tests.yml
      - ci/*

env:
  FILES: ci/goreleaser/goreleaser.yml ci/goreleaser/goreleaser-el7.yml ci/Dockerfile.std ci/Dockerfile.slim ci/aws/byol.pkr.hcl .github/workflows/release.yml .github/workflows/del-env.yml ci/terraform/outputs.tf .github/dependabot.yml ci/install/before_install.sh ci/install/post_install.sh ci/install/post_remove.sh ci/install/post_trans.sh .github/workflows/api-tests.yml
  
jobs:
  sync:
    runs-on: ubuntu-latest

    strategy:
      fail-fast: false
      matrix:
        branch: [ release-4-lts, release-3.2.3, release-4 ]
          
    steps:
      - uses: actions/checkout@v2
        with:
          ref: ${{matrix.branch}}

      - name: sync ${{matrix.branch}} from master
        run: |
          git fetch origin master
          git config --local user.email "wf-gen@tyk-ci"
          git config --local user.name "Bender"
          for f in $FILES; do 
            git checkout --theirs origin/master -- $f || true
          done
          git commit -a -m "[CI] Syncing release automation from master"
          git push origin
          echo "::debug::${FILES} syncd for ${{matrix.branch}}"
