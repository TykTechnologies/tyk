# Generated by: gromit policy
# Generated on: 2021-06-03 06:31:05.998191957 +0000 UTC

# This workflow should only exist in master
# Missing files are silently ignored. Most of the time this is what we want, older repos may not have some files
# If fwd or backport branches do not exist, they will be created

name: Sync automation

on:
  push:
    paths:
      - bin/unlock-agent.sh
      - .goreleaser.yml
      - Dockerfileg.std
      - Dockerfile.slim
      - aws/byol.pkr.hcl
      - .github/workflows/release.yml
      - .github/workflows/del-env.yml
      - integration/terraform/outputs.tf
      - install/before_install.sh
      - install/post_install.sh
      - install/post_remove.sh
      - images/*

jobs:



  fwdport:
    runs-on: ubuntu-latest

    strategy:
      fail-fast: false
      matrix:
        branch: 
          - release-3.2
          - release-3.2.0
          
    steps:
      - uses: actions/checkout@v2
        with:
          ref: ${{matrix.branch}}

      - name: Forward port master â†’ ${{matrix.branch}}
        run: |
          git checkout ${{matrix.branch}} || git checkout -b ${{matrix.branch}}
          git config --local user.email "policy@gromit"
          git config --local user.name "Bender"
          git checkout --theirs origin/master -- bin/unlock-agent.sh
          git checkout --theirs origin/master -- .goreleaser.yml
          git checkout --theirs origin/master -- Dockerfileg.std
          git checkout --theirs origin/master -- Dockerfile.slim
          git checkout --theirs origin/master -- aws/byol.pkr.hcl
          git checkout --theirs origin/master -- .github/workflows/release.yml
          git checkout --theirs origin/master -- .github/workflows/del-env.yml
          git checkout --theirs origin/master -- integration/terraform/outputs.tf
          git checkout --theirs origin/master -- install/before_install.sh
          git checkout --theirs origin/master -- install/post_install.sh
          git checkout --theirs origin/master -- install/post_remove.sh
          git checkout --theirs origin/master -- images/*
          git commit -m "[CI] Fwdport release automation from master" -m "${{ github.event.head_commit.message }}"
          git push -u origin ${{matrix.branch}}
          echo "::debug::syncd from master to ${{matrix.branch}}"

